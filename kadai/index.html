<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>myMemoPad</title>
<script src="js/jquery-2.1.3.min.js"></script>
<link rel="stylesheet" href="css/sample.css">
</head>
<body>
<header>
<h1>Diving Record</h1>
</header>
<main>

    <ul class="input">
        <li>Date<input type="date" id="date"></li>
        <li>Place<input type="text" id="place" placeholder="例：伊豆 Stone Wall"></li>
        <li>Depth<input type="text" id="depth" placeholder="例：25m"></li>
        <li>Fish <input type="file" id="example"><div id="preview"></div></li>
    </ul>

    <ul class="btns"> 
        <li id="save" class="btn"><span>Save</span></li>
        <li id="clear" class="btn"><span>Clear</span></li>
        <li id="reset" class="btn"><span>Reset</span></li>
    </ul>
</main>

<table id="list">
<!-- ここに追加データが挿入される -->
</table>
<script>

// 画像ファイルのプレビュー表示
function previewFile(file) {
  // プレビュー画像を追加する要素
  const preview = document.getElementById('preview');

  // FileReaderオブジェクトを作成
  const reader = new FileReader();

  // ファイルが読み込まれたときに実行する
  reader.onload = function (e) {
    const imageUrl = e.target.result; // 画像のURLはevent.target.resultで呼び出せる
    const img = document.createElement("img"); // img要素を作成
    img.src = imageUrl; // 画像のURLをimg要素にセット
    preview.appendChild(img); // #previewの中に追加
  }

  // いざファイルを読み込む
  reader.readAsDataURL(file);
}


// <input>でファイルが選択されたときの処理
const fileInput = document.getElementById('example');
const handleFileSelect = () => {
  const files = fileInput.files;
  for (let i = 0; i < files.length; i++) {
    previewFile(files[i]);
  }
}
fileInput.addEventListener('change', handleFileSelect);

//1.Save クリックイベント
$("#save").on("click",function(){

    const date = $("#date").val();
    const place = $("#place").val();
    const depth = $("#depth").val();
    const fish = $("#fish").val();

    var datalist = {
    Place: place,
    Depth: depth,
    Fish: fish,
}
 
    localStorage.setItem(date, datalist);
    localStorage.getItem(date); // -> "[object Object]"

    localStorage.setItem(date, JSON.stringify(datalist));
    JSON.parse(localStorage.getItem(date))  // -> {"data1":"hoge1", "data2":"hoge2"}

    const html = '<tr><th>'+date+'</th><td>'+place+'</td> <td>'+depth+'</td><td>'+fish+'</td></tr>';
    $("#list").append(html);
});


//2.clear クリックイベント
$("#reset").on("click",function(){
    localStorage.clear();
    $("#list").empty();
});

$("#clear").on("click",function(){
    $("#date").empty();
    $("#place").empty();
    $("#depth").empty();
    $("#fish").empty();
});



//3.ページ読み込み：保存データ取得表示
for(let i=0; i<localStorage.length; i++){
    const key   = localStorage.key(i);
    const value = localStorage.getItem(key);
}

</script>
</body>
</html>